# Group Chat AI - معمارية النظام

> • 🇺🇸 **This document is also available in:** [English](../ARCHITECTURE.md)
> • 🇸🇦 **هذا المستند متوفر أيضاً بـ:** [العربية](#)
> • 🇩🇪 **Dieses Dokument ist auch verfügbar in:** [Deutsch](./ARCHITECTURE_de.md)
> • 🇪🇸 **Este documento también está disponible en:** [Español](./ARCHITECTURE_es.md)
> • 🇫🇷 **Ce document est également disponible en:** [Français](./ARCHITECTURE_fr.md)
> • 🇮🇱 **מסמך זה זמין גם ב:** [עברית](./ARCHITECTURE_he.md)
> • 🇮🇹 **Questo documento è disponibile anche in:** [Italiano](./ARCHITECTURE_it.md)
> • 🇯🇵 **この文書は以下の言語でもご利用いただけます:** [日本語](./ARCHITECTURE_ja.md)
> • 🇰🇷 **이 문서는 다음 언어로도 제공됩니다:** [한국어](./ARCHITECTURE_ko.md)
> • 🇳🇱 **Dit document is ook beschikbaar in:** [Nederlands](./ARCHITECTURE_nl.md)
> • 🇵🇹 **Este documento também está disponível em:** [Português](./ARCHITECTURE_pt.md)
> • 🇷🇺 **Этот документ также доступен на:** [Русский](./ARCHITECTURE_ru.md)
> • 🇸🇪 **Detta dokument är också tillgängligt på:** [Svenska](./ARCHITECTURE_sv.md)
> • 🇨🇳 **本文档还提供以下语言版本:** [中文](./ARCHITECTURE_zh.md)


## نظرة عامة

Group Chat AI هي منصة ذكاء اصطناعي محادثة متطورة في الوقت الفعلي تمكن المستخدمين من المشاركة في مناقشات تعاونية مع شخصيات ذكاء اصطناعي متعددة. يستفيد النظام من خدمات AWS السحابية لتقديم حل قابل للتوسع وآمن وعالي الأداء مع تفاعلات صوتية ونصية في الوقت الفعلي للمحادثات الجماعية.

## مخططات المعمارية

### معمارية النظام عالية المستوى
![Group Chat AI System Architecture](ARCHITECTURE.png)

## مكونات النظام

### 1. طبقة الواجهة الأمامية

#### **CloudFront Distribution**
- **الغرض**: شبكة توصيل المحتوى العالمية للحصول على أداء مثالي
- **الميزات**:
  - تخزين مؤقت للأصول الثابتة (بناء تطبيق React)
  - توجيه طلبات API إلى ALB الخلفي
  - وكيل اتصالات WebSocket للتواصل في الوقت الفعلي
  - سياسات القيود الجغرافية والأمان
  - دعم النطاق المخصص مع شهادات ACM

#### **S3 Static Hosting**
- **الغرض**: يخدم مصنوعات بناء تطبيق React
- **المحتوى**:
  - حزم HTML وCSS وJavaScript
  - الأصول الثابتة (الصور والخطوط وملفات الترجمة)
  - ملفات التكوين الديناميكية (config.json لإعدادات خاصة بالبيئة)

#### **React Frontend Application**
- **التقنية**: React 18 مع TypeScript ونظام بناء Vite
- **الميزات**:
  - تواصل WebSocket في الوقت الفعلي
  - قدرات الإدخال/الإخراج الصوتي
  - التدويل متعدد اللغات
  - تصميم متجاوب مع مكونات واجهة مستخدم حديثة
  - رفع ومعالجة الصور

### 2. المصادقة والتخويل

#### **Amazon Cognito User Pool**
- **الغرض**: مصادقة وإدارة المستخدمين المركزية
- **الميزات**:
  - تكامل OAuth 2.0 / OpenID Connect
  - التسجيل والتحقق القائم على البريد الإلكتروني
  - سياسات كلمات المرور واستعادة الحساب
  - التكامل مع الواجهة الأمامية عبر تدفق OIDC

#### **User Pool Client**
- **التكوين**:
  - تدفق Authorization Code Grant
  - عناوين URL للاستدعاء لبيئات التطوير والإنتاج
  - النطاقات: openid وemail وprofile
  - فترات صلاحية الرموز محسنة للأمان

### 3. البنية التحتية للشبكة

#### **VPC (Virtual Private Cloud)**
- **التصميم**: نشر متعدد AZ للتوفر العالي
- **الشبكات الفرعية**:
  - **الشبكات الفرعية العامة**: تستضيف ALB وNAT Gateway
  - **الشبكات الفرعية الخاصة**: تستضيف مهام ECS Fargate للأمان

#### **Application Load Balancer (ALB)**
- **الغرض**: توزيع حركة HTTP/HTTPS وإنهاء SSL
- **الأمان**: **حرج - ALB يقبل الحركة فقط من نطاقات IP الخاصة بـ CloudFront**
- **الميزات**:
  - فحوصات الصحة لخدمات ECS
  - التوجيه القائم على المسار (/api/* → backend، /ws/* → WebSocket)
  - مجموعات الأمان مكونة مع قوائم البادئات المدارة من CloudFront
  - تسجيل الوصول إلى S3
  - **جميع حركة المستخدمين (HTTP/WebSocket) يجب أن تتدفق عبر CloudFront**

### 4. الخدمات الخلفية (ECS Fargate)

#### **Express.js Application Server**
- **وقت التشغيل**: Node.js 20 مع TypeScript
- **المعمارية**: تصميم موجه للخدمات المصغرة
- **المكونات الأساسية**:
  - نقاط نهاية REST API لإدارة الجلسات
  - خادم WebSocket للتواصل في الوقت الفعلي
  - البرمجيات الوسطية للتسجيل ومعالجة الأخطاء والأمان

#### **مكونات الخدمة الأساسية**

##### **ConversationOrchestrator**
- **الغرض**: المنسق المركزي لمحادثات الذكاء الاصطناعي
- **المسؤوليات**:
  - توجيه الرسائل واختيار الشخصية
  - إدارة طابور الصوت لتدفق المحادثة الطبيعي
  - بث الاستجابة في الوقت الفعلي
  - إدارة المحادثة التكرارية

##### **PersonaManager & PersonaAgent**
- **الغرض**: يدير تعريفات وسلوكيات شخصيات الذكاء الاصطناعي
- **الميزات**:
  - إنشاء وإدارة الشخصيات المخصصة
  - سياقات المحادثة الخاصة بالشخصية
  - اختيار الشخصية الديناميكي بناءً على تحليل المحتوى

##### **RoutingAgent**
- **الغرض**: التوجيه الذكي لرسائل المستخدمين إلى الشخصيات المناسبة
- **التقنية**: يستخدم Amazon Bedrock لاتخاذ القرارات
- **الميزات**:
  - تحليل المحتوى وتسجيل صلة الشخصية
  - منطق استمرار المحادثة
  - تنسيق التفاعل متعدد الشخصيات

##### **SessionService**
- **الغرض**: يدير جلسات المستخدمين وحالة المحادثة
- **الميزات**:
  - إدارة دورة حياة الجلسة
  - استمرارية تاريخ المحادثة
  - التخصيصات الخاصة بالمستخدم

##### **WebSocket Management**
- **المكونات**: WebSocketServer وWebSocketController وSessionWebSocketManager
- **الميزات**:
  - تواصل ثنائي الاتجاه في الوقت الفعلي
  - اتصالات WebSocket خاصة بالجلسة
  - بروتوكولات بث الصوت والإقرار

### 5. تكامل خدمات الذكاء الاصطناعي/التعلم الآلي

#### **Amazon Bedrock**
- **النماذج**: Claude 4 (us.anthropic.claude-sonnet-4-20250514-v1:0)
- **الاستخدام**:
  - توليد المحادثات لشخصيات الذكاء الاصطناعي
  - تحليل المحتوى وقرارات التوجيه
  - توليد الاستجابة الواعية للسياق
- **التكوين**: عبر Parameter Store للإعدادات الخاصة بالبيئة

#### **Amazon Polly**
- **الغرض**: تحويل النص إلى كلام للتفاعلات الصوتية
- **الميزات**:
  - خيارات صوتية متعددة مع تعيينات خاصة بالشخصية
  - أسلوب التحدث الإخباري لشخصيات معينة
  - تركيب الصوت المتدفق
  - اختيار الصوت الواعي للغة

### 6. التكوين والمراقبة

#### **AWS Systems Manager Parameter Store**
- **الغرض**: إدارة التكوين المركزية
- **المعاملات**:
  - إعدادات نموذج ومزود LLM
  - تفاصيل تكوين Cognito
  - الإعدادات الخاصة بالبيئة

#### **CloudWatch Logs & Metrics**
- **الميزات**:
  - التسجيل المركزي لجميع الخدمات
  - مقاييس الأداء والمراقبة
  - تتبع الأخطاء والتنبيه
  - مقاييس مخصصة لاستخدام خدمات الذكاء الاصطناعي

## أنماط تدفق البيانات

### 1. تدفق مصادقة المستخدم
```
User → CloudFront → Cognito User Pool → OAuth Flow → JWT Token → API Calls
```

### 2. تدفق المحادثة في الوقت الفعلي
```
User Message → WebSocket (via CloudFront) → ALB → ConversationOrchestrator → RoutingAgent → PersonaAgent → Bedrock → Response → Polly → Audio Stream → WebSocket (via CloudFront) → User
```

### 3. خط أنابيب معالجة الذكاء الاصطناعي
```
User Input → Content Analysis → Persona Selection → Context Building → LLM Request → Response Generation → Audio Synthesis → Queue Management → Delivery
```

## معمارية الأمان

### أمان الشبكة
- **تكامل WAF**: جدار حماية تطبيقات الويب المتكامل مع CloudFront
- **أمان VPC**: شبكات فرعية خاصة للخدمات الخلفية
- **مجموعات الأمان**: التحكم في الوصول بأقل الامتيازات
- **قيود ALB**: قيود نطاق IP الخاص بـ CloudFront

### أمان البيانات
- **التشفير أثناء النقل**: HTTPS/TLS في كل مكان
- **التشفير أثناء الراحة**: تشفير S3 وParameter Store
- **إدارة الأسرار**: Parameter Store للتكوين الحساس
- **التحكم في الوصول**: أدوار IAM بأقل الصلاحيات

### أمان التطبيق
- **المصادقة**: OAuth 2.0/OIDC القائم على Cognito
- **التخويل**: التحقق من رمز JWT
- **التحقق من الإدخال**: التحقق الشامل من الطلبات
- **تحديد المعدل**: حدود API واتصال WebSocket

## القابلية للتوسع والأداء

### التوسع التلقائي
- **خدمة ECS**: التوسع التلقائي القائم على CPU والذاكرة (1-10 مهام)
- **ALB**: التوسع التلقائي بناءً على الحركة
- **CloudFront**: مواقع الحافة العالمية لـ CDN

### تحسينات الأداء
- **التخزين المؤقت**: تخزين CloudFront المؤقت للأصول الثابتة
- **بث الصوت**: عناوين URL لبيانات Base64 للتشغيل الفوري
- **تجميع الاتصالات**: إدارة فعالة لاتصال WebSocket
- **التحميل الكسول**: تهيئة الخدمة عند الطلب

### التوفر العالي
- **نشر متعدد AZ**: VPC يمتد عبر مناطق توفر متعددة
- **فحوصات الصحة**: مراقبة صحة ALB لخدمات ECS
- **التدهور التدريجي**: آليات الاحتياط لفشل الخدمة

## ملخص مجموعة التقنيات

### الواجهة الأمامية
- **الإطار**: React 18 مع TypeScript
- **أداة البناء**: Vite
- **التصميم**: CSS حديث مع تصميم متجاوب
- **إدارة الحالة**: React Context API
- **المصادقة**: OIDC Client
- **الوقت الفعلي**: WebSocket API

### الخلفية
- **وقت التشغيل**: Node.js 20
- **الإطار**: Express.js
- **اللغة**: TypeScript
- **WebSocket**: مكتبة ws
- **التسجيل**: Winston
- **الاختبار**: Jest

### البنية التحتية
- **التنسيق**: AWS CDK (TypeScript)
- **الحوسبة**: ECS Fargate
- **التخزين**: S3
- **CDN**: CloudFront
- **قاعدة البيانات**: إدارة الحالة في الذاكرة
- **التكوين**: Parameter Store

### الذكاء الاصطناعي/التعلم الآلي
- **LLM**: Amazon Bedrock (Claude 4)
- **TTS**: Amazon Polly
- **تحليل المحتوى**: خدمة مخصصة مع تكامل LLM

## معمارية النشر

### استراتيجية البيئة
- **التطوير**: التطوير المحلي مع منفذ خلفي 3000
- **الإنتاج**: البنية التحتية المنشورة بـ CDK مع CloudFront

### خط أنابيب CI/CD
- **الواجهة الأمامية**: بناء Vite → نشر S3 → إبطال CloudFront
- **الخلفية**: بناء Docker → ECR → تحديث خدمة ECS
- **البنية التحتية**: فرق CDK → النشر → التحقق

### إدارة التكوين
- **متغيرات البيئة**: تكوين على مستوى الحاوية
- **الأسرار**: تكامل Parameter Store
- **أعلام الميزات**: التمكين القائم على البيئة

## المراقبة وقابلية الملاحظة

### استراتيجية التسجيل
- **مركزي**: جميع السجلات تتدفق إلى CloudWatch
- **منظم**: إدخالات السجل بتنسيق JSON
- **الارتباط**: معرفات الطلب للتتبع
- **المستويات**: تصنيف Debug وInfo وWarn وError

### المقاييس والإنذارات
- **مقاييس التطبيق**: أوقات الاستجابة ومعدلات الخطأ
- **مقاييس البنية التحتية**: استخدام CPU والذاكرة والشبكة
- **مقاييس الأعمال**: معدلات إكمال المحادثة واستخدام الشخصية
- **الإنذارات المخصصة**: اكتشاف المشاكل الاستباقي

### مراقبة الصحة
- **نقاط نهاية الصحة**: /health لحالة الخدمة
- **فحوصات التبعية**: اتصال الخدمة الخارجية
- **التدهور التدريجي**: مراقبة سلوك الاحتياط

## اعتبارات المعمارية المستقبلية

### تحسينات القابلية للتوسع
- **تكامل قاعدة البيانات**: النظر في RDS للتخزين المستمر
- **طبقة التخزين المؤقت**: Redis/ElastiCache لحالة الجلسة
- **الخدمات المصغرة**: تفكيك الخدمة أكثر

### تحسينات الذكاء الاصطناعي/التعلم الآلي
- **ضبط النموذج**: تدريب النموذج المخصص
- **اختبار A/B**: مقارنة نماذج متعددة
- **تحليلات المحادثة**: رؤى الاستخدام المتقدمة

### تحسينات الأمان
- **قواعد WAF**: حماية محسنة من الهجمات
- **API Gateway**: النظر في الهجرة للميزات المتقدمة
- **الامتثال**: اعتبارات SOC 2 وGDPR

توفر هذه المعمارية أساسًا قويًا وقابلًا للتوسع وآمنًا لمنصة Group Chat AI مع الحفاظ على المرونة للتحسينات والنمو المستقبلي.