# Language Validation Tests

This directory contains automated tests to validate internationalization (i18n) implementation across the frontend codebase.

## Test Files

### 1. `i18n-key-validation.test.ts`
**Purpose**: Validates that all internationalization keys used in the frontend code exist in English JSON translation files.

**What it checks**:
- Scans all TypeScript/TSX files for `t('key')` translation function calls
- Verifies each key exists in the corresponding English namespace files
- Supports both simple keys (`key`) and namespaced keys (`namespace:key`)
- Validates that all expected namespace files exist (`common.json`, `pages.json`, `components.json`, `personas.json`)
- Ensures English translation files are valid JSON

**Example violations**:
```bash
Missing translation keys:
  - pastConversations.confirmDelete
  - logout.signingOut
  - pages.userGuides.features.contentManagement.title
```

### 2. `hardcoded-text-detection.test.ts`
**Purpose**: Detects hardcoded English text that should be internationalized instead.

**What it checks**:
- Scans TypeScript/TSX files for hardcoded English text in JSX elements
- Detects hardcoded strings in component properties (`placeholder`, `title`, `label`, etc.)
- Excludes technical terms, constants, URLs, and other non-user-facing text
- Provides intelligent filtering to avoid false positives

**Example violations**:
```bash
Found hardcoded English text in JSX elements:
  utils/chatExport.ts:72 - "No messages in this session."
  utils/chatExport.ts:82 - "Generated by Group Chat AI - Practice your presentations with AI-powered personas"
```

**Smart filtering excludes**:
- Technical terms (API, URL, HTTP, AWS, etc.)
- Constants and variables (camelCase, UPPER_CASE)
- URLs, paths, and email addresses
- CSS values and colors
- Very short strings (≤2 characters)
- Translation keys (containing dots without spaces)
- Copyright notices and license identifiers

### 3. `translation-completeness.test.ts`
**Purpose**: Ensures all supported languages have complete and consistent translations compared to English.

**What it checks**:
- All languages have the same namespace files as English
- All translation files contain valid JSON
- All languages have matching keys to English (no missing translations)
- No languages have extra keys not present in English
- Translation values are not empty or placeholder text

**Example violations**:
```bash
Missing translation keys:
  es:
    - common: actions.newFeature
    - pages: dashboard.analytics.title
  fr:
    - components: languageSelector.placeholder
```

## Running the Tests

```bash
# Run all language validation tests
npm test

# Run specific test file
npm test i18n-key-validation.test.ts
npm test hardcoded-text-detection.test.ts
npm test translation-completeness.test.ts

# Run tests with coverage
npm run test:coverage

# Watch mode for development
npm run test:watch
```

## Configuration

### File Structure Expected
```
frontend/
├── public/locales/
│   ├── en/                 # English (reference language)
│   │   ├── common.json
│   │   ├── pages.json
│   │   ├── components.json
│   │   └── personas.json
│   ├── es/                 # Spanish
│   ├── fr/                 # French
│   └── ...                 # Other languages
└── src/                    # Source code to scan
```

### Supported Languages
The tests automatically detect all language directories in `public/locales/` and validate them against English.

Current supported languages: `en`, `es`, `fr`, `de`, `ja`, `zh`, `ko`, `it`, `he`, `nl`, `pt`, `ru`, `sv`, `ar`

## Fixing Issues

### Missing Translation Keys
1. Add the missing keys to the appropriate English JSON files
2. Run `npm run i18n:update-languages` to propagate to other languages

### Hardcoded Text
1. Replace hardcoded strings with `t('key')` calls
2. Add the translation key to the appropriate English JSON file
3. Import `useTranslation` hook if not already imported

### Missing Language Files
1. Use `npm run i18n:add-language` to add missing languages
2. Or manually create the required JSON files

### Translation Completeness
1. Use `npm run i18n:update-languages` to sync missing keys
2. Review and translate any placeholder values

## Integration

These tests are designed to be run in CI/CD pipelines to catch internationalization issues early:

```yaml
# Example GitHub Actions step
- name: Run i18n validation tests
  run: |
    cd frontend
    npm test i18n-key-validation.test.ts
    npm test hardcoded-text-detection.test.ts
    npm test translation-completeness.test.ts
```

## Best Practices

1. **Always use translation keys** instead of hardcoded text
2. **Run tests before committing** changes that add new user-facing text
3. **Follow naming conventions** for translation keys (use dot notation for hierarchy)
4. **Keep translations organized** by feature/component in appropriate namespaces
5. **Test with multiple languages** during development to catch layout issues

## Troubleshooting

### False Positives in Hardcoded Text Detection
If the test incorrectly flags technical terms, add them to the `technicalTerms` array in `hardcoded-text-detection.test.ts`.

### Path Resolution Issues
If tests can't find translation files, verify the path resolution in the test files matches your project structure.

### TypeScript Errors
Ensure Jest types are properly configured in `tsconfig.json` and test setup files are in place.