
> • 🇺🇸 **This document is also available in:** [English](../THREAT_MODEL.md)
> • 🇸🇦 **هذا المستند متوفر أيضاً بـ:** [العربية](./THREAT_MODEL_ar.md)
> • 🇩🇪 **Dieses Dokument ist auch verfügbar in:** [Deutsch](./THREAT_MODEL_de.md)
> • 🇪🇸 **Este documento también está disponible en:** [Español](./THREAT_MODEL_es.md)
> • 🇫🇷 **Ce document est également disponible en:** [Français](./THREAT_MODEL_fr.md)
> • 🇮🇱 **מסמך זה זמין גם ב:** [עברית](./THREAT_MODEL_he.md)
> • 🇮🇹 **Questo documento è disponibile anche in:** [Italiano](./THREAT_MODEL_it.md)
> • 🇯🇵 **この文書は以下の言語でもご利用いただけます:** [日本語](./THREAT_MODEL_ja.md)
> • 🇰🇷 **이 문서는 다음 언어로도 제공됩니다:** [한국어](./THREAT_MODEL_ko.md)
> • 🇳🇱 **Dit document is ook beschikbaar in:** [Nederlands](./THREAT_MODEL_nl.md)
> • 🇵🇹 **Este documento também está disponível em:** [Português](./THREAT_MODEL_pt.md)
> • 🇷🇺 **Этот документ также доступен на:** [Русский](./THREAT_MODEL_ru.md)
> • 🇸🇪 **Detta dokument är också tillgängligt på:** [Svenska](./THREAT_MODEL_sv.md)
> • 🇨🇳 **本文档还提供以下语言版本:** [中文](#)

<!--
 Copyright 2025 Amazon.com, Inc. or its affiliates.
 SPDX-License-Identifier: MIT-0
-->

# 群聊 AI
## 应用信息
这是一个实时对话 AI 平台，使用户能够与多个 AI 角色练习演示。功能包括 WebSocket 通信、语音合成、图像上传、自定义角色创建，以及 AWS Bedrock 集成用于 LLM 处理。

## 架构
### 介绍
**群聊架构概述：**

1. **前端层**：通过 Amazon CloudFront 和 S3 静态托管提供的 React 应用程序，支持实时 WebSocket 连接和图像上传
2. **身份验证**：Amazon Cognito User Pool 与 OAuth 2.0/OIDC 用于安全的用户管理
3. **网络安全**：VPC 架构，ALB 限制为 CloudFront IP 范围，后端服务使用私有子网
4. **后端服务**：ECS Fargate 托管 Express.js 服务器，支持 WebSocket、ConversationOrchestrator、PersonaManager 和 SessionService
5. **AI 集成**：Amazon Bedrock 用于 LLM 处理（Claude 模型），AWS Polly 用于语音合成，支持角色特定语音
6. **配置**：Parameter Store 用于集中配置，CloudWatch 用于全面监控和日志记录

## 数据流
### 介绍
#### 实体：

| 实体 | 描述 |
|-|-|
| User | 与 AI 角色练习演示的个人用户 |
| React Frontend | 具有实时聊天和语音功能的 Web 应用程序 |
| CloudFront | 提供前端服务并代理 API/WebSocket 请求的 CDN |
| Amazon Cognito | 用户身份验证和会话管理 |
| ALB | 具有 CloudFront IP 限制的应用程序负载均衡器 |
| ECS Backend | 具有 WebSocket 和 AI 编排功能的 Express.js 服务器 |
| Amazon Bedrock | 用于 AI 角色响应的 LLM 服务 |
| Amazon Polly | 语音合成的文本转语音服务 |
| Parameter Store | 配置管理服务 |

#### 数据流：

| 流程 ID | 描述 | 源 | 目标 | 资产 |
|-|-|-|-|-|
| DF1 | 用户身份验证流程 | User | Amazon Cognito | 用户凭据、JWT 令牌 |
| DF2 | 前端应用程序访问 | User | CloudFront | HTTP 请求、静态资产 |
| DF3 | 实时通信 | User | ECS Backend | WebSocket 连接、聊天消息 |
| DF4 | API 请求路由 | CloudFront | ALB | 已认证的 API 请求 |
| DF5 | AI 对话处理 | ECS Backend | Amazon Bedrock | 用户提示、角色响应 |
| DF6 | 语音合成请求 | ECS Backend | Amazon Polly | 文本内容、音频流 |
| DF7 | 图像上传和分析 | User | ECS Backend | 图像文件、分析结果 |
| DF8 | 配置检索 | ECS Backend | Parameter Store | 应用程序配置 |
| DF9 | 会话状态管理 | ECS Backend | In-Memory Store | 用户会话、对话历史 |

#### 信任边界：

| 边界 ID | 目的 | 源 | 目标 |
|-|-|-|-|
| TB1 | 互联网/CDN 边界 | User | CloudFront |
| TB2 | CDN/负载均衡器边界 | CloudFront | ALB |
| TB3 | 负载均衡器/应用程序边界 | ALB | ECS Backend |
| TB4 | 应用程序/AI 服务边界 | ECS Backend | Amazon Bedrock |
| TB5 | 应用程序/语音服务边界 | ECS Backend | Amazon Polly |
| TB6 | 应用程序/配置边界 | ECS Backend | Parameter Store |
| TB7 | 用户会话隔离边界 | User Session A | User Session B |

#### 威胁源：

| 类别 | 描述 | 示例 |
|-|-|-|
| 外部攻击者 | 试图访问系统的未授权用户 | Web 攻击者、API 滥用者 |
| 恶意用户 | 具有恶意意图的已认证用户 | 提示注入攻击者、数据泄露尝试 |
| 被入侵账户 | 被攻击者控制的合法账户 | 会话劫持者、凭据填充者 |
| AI 模型威胁 | 针对 AI/LLM 组件的威胁 | 模型操纵、提示注入 |
| 基础设施威胁 | 对底层 AWS 服务的威胁 | 服务中断、配置篡改 |

## 假设

| 假设编号 | 假设 | 关联威胁 | 关联缓解措施 | 备注 |
| --- | --- | --- | --- | --- |
| <a name="A-0005"></a>A-0005 | 敏感配置数据不包含硬编码的密钥或凭据 | [**T-0008**](#T-0008): 内部参与者可以否认向 AI 角色发出不当请求，这导致系统滥用缺乏问责制，从而降低审计日志和合规记录的问责性<br/>[**T-0009**](#T-0009): 具有系统访问权限的恶意用户可以操纵对话历史或角色响应，这导致数据篡改和对话完整性丢失，从而降低对话历史和角色响应的完整性 |  |  |
| <a name="A-0004"></a>A-0004 | 应用程序定期进行安全测试和漏洞评估 | [**T-0003**](#T-0003): 具有有效会话凭据的恶意用户可以访问其他用户的对话会话，这导致未授权的数据泄露和隐私侵犯，从而降低用户对话和会话数据的机密性<br/>[**T-0006**](#T-0006): 拥有被盗或被入侵 JWT 令牌的外部威胁参与者可以冒充合法用户，这导致对用户账户和数据的未授权访问，从而降低用户账户和对话数据的机密性和/或完整性<br/>[**T-0007**](#T-0007): 恶意用户可以通过过量请求滥用语音合成服务，这导致资源耗尽和成本增加，从而降低语音服务的可用性<br/>[**T-0008**](#T-0008): 内部参与者可以否认向 AI 角色发出不当请求，这导致系统滥用缺乏问责制，从而降低审计日志和合规记录的问责性<br/>[**T-0009**](#T-0009): 具有系统访问权限的恶意用户可以操纵对话历史或角色响应，这导致数据篡改和对话完整性丢失，从而降低对话历史和角色响应的完整性 |  |  |
| <a name="A-0003"></a>A-0003 | Amazon Bedrock 和 Polly 服务具有内置的安全控制来防止滥用 |  |  |  |
| <a name="A-0002"></a>A-0002 | CloudFront IP 限制已正确配置以防止 ALB 绕过 |  |  |  |
| <a name="A-0001"></a>A-0001 | AWS 基础设施安全控制已正确配置和维护 | [**T-0001**](#T-0001): 具有系统认证访问权限的恶意用户可以向 AI 角色对话注入恶意提示，这导致 AI 响应操纵和潜在的系统入侵，从而降低 AI 角色响应和对话数据的机密性和/或完整性<br/>[**T-0002**](#T-0002): 外部攻击者可以绕过 CloudFront 直接访问 ALB，这导致未授权的 API 访问和潜在的系统入侵，从而降低后端服务和用户数据的机密性、完整性和/或可用性<br/>[**T-0004**](#T-0004): 外部威胁参与者可以用 WebSocket 连接请求淹没系统，这导致服务降级和拒绝服务，从而降低 WebSocket 服务和后端 API 服务的可用性<br/>[**T-0005**](#T-0005): 恶意用户可以上传包含可执行代码或恶意软件的恶意图像，这导致潜在的代码执行或系统入侵，从而降低图像处理服务和后端基础设施的完整性和/或可用性<br/>[**T-0006**](#T-0006): 拥有被盗或被入侵 JWT 令牌的外部威胁参与者可以冒充合法用户，这导致对用户账户和数据的未授权访问，从而降低用户账户和对话数据的机密性和/或完整性 |  |  |

## 威胁

| 威胁编号 | 威胁 | 缓解措施 | 假设 | 状态 | 优先级 | STRIDE | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <a name="T-0009"></a>T-0009 | 具有系统访问权限的恶意用户可以操纵对话历史或角色响应，这导致数据篡改和对话完整性丢失，从而降低对话历史和角色响应的完整性 | [**M-0008**](#M-0008): 使用具有适当过期时间和验证的 JWT 令牌<br/>[**M-0010**](#M-0010): 实施适当的错误处理以防止信息泄露<br/>[**M-0007**](#M-0007): 为安全事件实施全面的日志记录和监控<br/>[**M-0003**](#M-0003): 强制执行严格的会话隔离并实施适当的授权检查 | [**A-0005**](#A-0005): 敏感配置数据不包含硬编码的密钥或凭据<br/>[**A-0004**](#A-0004): 应用程序定期进行安全测试和漏洞评估 |  已解决 | 中等 |  |  |
| <a name="T-0008"></a>T-0008 | 内部参与者可以否认向 AI 角色发出不当请求，这导致系统滥用缺乏问责制，从而降低审计日志和合规记录的问责性 | [**M-0008**](#M-0008): 使用具有适当过期时间和验证的 JWT 令牌<br/>[**M-0010**](#M-0010): 实施适当的错误处理以防止信息泄露<br/>[**M-0003**](#M-0003): 强制执行严格的会话隔离并实施适当的授权检查 | [**A-0005**](#A-0005): 敏感配置数据不包含硬编码的密钥或凭据<br/>[**A-0004**](#A-0004): 应用程序定期进行安全测试和漏洞评估 |  已解决 | 低 |  |  |
| <a name="T-0007"></a>T-0007 | 恶意用户可以通过过量请求滥用语音合成服务，这导致资源耗尽和成本增加，从而降低语音服务的可用性 | [**M-0004**](#M-0004): 在 API 端点和 WebSocket 连接上实施速率限制 | [**A-0004**](#A-0004): 应用程序定期进行安全测试和漏洞评估 |  已解决 | 中等 |  |  |
| <a name="T-0006"></a>T-0006 | 拥有被盗或被入侵 JWT 令牌的外部威胁参与者可以冒充合法用户，这导致对用户账户和数据的未授权访问，从而降低用户账户和对话数据的机密性和/或完整性 | [**M-0008**](#M-0008): 使用具有适当过期时间和验证的 JWT 令牌<br/>[**M-0006**](#M-0006): 使用 AWS WAF 与 CloudFront 来防护常见的 Web 攻击<br/>[**M-0003**](#M-0003): 强制执行严格的会话隔离并实施适当的授权检查<br/>[**M-0010**](#M-0010): 实施适当的错误处理以防止信息泄露 | [**A-0004**](#A-0004): 应用程序定期进行安全测试和漏洞评估<br/>[**A-0001**](#A-0001): AWS 基础设施安全控制已正确配置和维护 |  已解决 | 中等 |  |  |
| <a name="T-0005"></a>T-0005 | 恶意用户可以上传包含可执行代码或恶意软件的恶意图像，这导致潜在的代码执行或系统入侵，从而降低图像处理服务和后端基础设施的完整性和/或可用性 | [**M-0005**](#M-0005): 通过文件类型和大小限制验证和清理图像上传 | [**A-0001**](#A-0001): AWS 基础设施安全控制已正确配置和维护 |  已解决 | 中等 |  |  |
| <a name="T-0004"></a>T-0004 | 外部威胁参与者可以用 WebSocket 连接请求淹没系统，这导致服务降级和拒绝服务，从而降低 WebSocket 服务和后端 API 服务的可用性 | [**M-0004**](#M-0004): 在 API 端点和 WebSocket 连接上实施速率限制 | [**A-0001**](#A-0001): AWS 基础设施安全控制已正确配置和维护 |  已解决 | 中等 |  |  |
| <a name="T-0003"></a>T-0003 | 具有有效会话凭据的恶意用户可以访问其他用户的对话会话，这导致未授权的数据泄露和隐私侵犯，从而降低用户对话和会话数据的机密性 | [**M-0008**](#M-0008): 使用具有适当过期时间和验证的 JWT 令牌<br/>[**M-0006**](#M-0006): 使用 AWS WAF 与 CloudFront 来防护常见的 Web 攻击 | [**A-0004**](#A-0004): 应用程序定期进行安全测试和漏洞评估 |  已解决 | 中等 |  |  |
| <a name="T-0002"></a>T-0002 | 外部攻击者可以绕过 CloudFront 直接访问 ALB，这导致未授权的 API 访问和潜在的系统入侵，从而降低后端服务和用户数据的机密性、完整性和/或可用性 | [**M-0009**](#M-0009): 仅限制 ALB 访问 CloudFront IP 范围 | [**A-0001**](#A-0001): AWS 基础设施安全控制已正确配置和维护 |  已解决 | 中等 |  |  |
| <a name="T-0001"></a>T-0001 | 具有系统认证访问权限的恶意用户可以向 AI 角色对话注入恶意提示，这导致 AI 响应操纵和潜在的系统入侵，从而降低 AI 角色响应和对话数据的机密性和/或完整性 | [**M-0002**](#M-0002): 使用参数化提示和提示隔离来防止 AI 提示注入<br/>[**M-0001**](#M-0001): 对所有用户输入实施全面的输入验证和清理<br/>[**M-0008**](#M-0008): 使用具有适当过期时间和验证的 JWT 令牌 | [**A-0001**](#A-0001): AWS 基础设施安全控制已正确配置和维护 |  已解决 | 高 |  |  |

## 缓解措施

| 缓解措施编号 | 缓解措施 | 缓解的威胁 | 假设 | 状态 | 备注 |
| --- | --- | --- | --- | --- | --- |
| <a name="M-0010"></a>M-0010 | 实施适当的错误处理以防止信息泄露 | [**T-0006**](#T-0006): 拥有被盗或被入侵 JWT 令牌的外部威胁参与者可以冒充合法用户，这导致对用户账户和数据的未授权访问，从而降低用户账户和对话数据的机密性和/或完整性<br/>[**T-0008**](#T-0008): 内部参与者可以否认向 AI 角色发出不当请求，这导致系统滥用缺乏问责制，从而降低审计日志和合规记录的问责性<br/>[**T-0009**](#T-0009): 具有系统访问权限的恶意用户可以操纵对话历史或角色响应，这导致数据篡改和对话完整性丢失，从而降低对话历史和角色响应的完整性 |  | 已解决 |  |
| <a name="M-0009"></a>M-0009 | 仅限制 ALB 访问 CloudFront IP 范围 | [**T-0002**](#T-0002): 外部攻击者可以绕过 CloudFront 直接访问 ALB，这导致未授权的 API 访问和潜在的系统入侵，从而降低后端服务和用户数据的机密性、完整性和/或可用性 |  | 已解决 |  |
| <a name="M-0008"></a>M-0008 | 使用具有适当过期时间和验证的 JWT 令牌 | [**T-0001**](#T-0001): 具有系统认证访问权限的恶意用户可以向 AI 角色对话注入恶意提示，这导致 AI 响应操纵和潜在的系统入侵，从而降低 AI 角色响应和对话数据的机密性和/或完整性<br/>[**T-0003**](#T-0003): 具有有效会话凭据的恶意用户可以访问其他用户的对话会话，这导致未授权的数据泄露和隐私侵犯，从而降低用户对话和会话数据的机密性<br/>[**T-0006**](#T-0006): 拥有被盗或被入侵 JWT 令牌的外部威胁参与者可以冒充合法用户，这导致对用户账户和数据的未授权访问，从而降低用户账户和对话数据的机密性和/或完整性<br/>[**T-0008**](#T-0008): 内部参与者可以否认向 AI 角色发出不当请求，这导致系统滥用缺乏问责制，从而降低审计日志和合规记录的问责性<br/>[**T-0009**](#T-0009): 具有系统访问权限的恶意用户可以操纵对话历史或角色响应，这导致数据篡改和对话完整性丢失，从而降低对话历史和角色响应的完整性 |  | 已解决 |  |
| <a name="M-0007"></a>M-0007 | 为安全事件实施全面的日志记录和监控 | [**T-0009**](#T-0009): 具有系统访问权限的恶意用户可以操纵对话历史或角色响应，这导致数据篡改和对话完整性丢失，从而降低对话历史和角色响应的完整性 |  | 已解决 |  |
| <a name="M-0006"></a>M-0006 | 使用 AWS WAF 与 CloudFront 来防护常见的 Web 攻击 | [**T-0003**](#T-0003): 具有有效会话凭据的恶意用户可以访问其他用户的对话会话，这导致未授权的数据泄露和隐私侵犯，从而降低用户对话和会话数据的机密性<br/>[**T-0006**](#T-0006): 拥有被盗或被入侵 JWT 令牌的外部威胁参与者可以冒充合法用户，这导致对用户账户和数据的未授权访问，从而降低用户账户和对话数据的机密性和/或完整性 |  | 已解决 |  |
| <a name="M-0005"></a>M-0005 | 通过文件类型和大小限制验证和清理图像上传 | [**T-0005**](#T-0005): 恶意用户可以上传包含可执行代码或恶意软件的恶意图像，这导致潜在的代码执行或系统入侵，从而降低图像处理服务和后端基础设施的完整性和/或可用性 |  | 已解决 |  |
| <a name="M-0004"></a>M-0004 | 在 API 端点和 WebSocket 连接上实施速率限制 | [**T-0004**](#T-0004): 外部威胁参与者可以用 WebSocket 连接请求淹没系统，这导致服务降级和拒绝服务，从而降低 WebSocket 服务和后端 API 服务的可用性<br/>[**T-0007**](#T-0007): 恶意用户可以通过过量请求滥用语音合成服务，这导致资源耗尽和成本增加，从而降低语音服务的可用性 |  | 已解决 |  |
| <a name="M-0003"></a>M-0003 | 强制执行严格的会话隔离并实施适当的授权检查 | [**T-0006**](#T-0006): 拥有被盗或被入侵 JWT 令牌的外部威胁参与者可以冒充合法用户，这导致对用户账户和数据的未授权访问，从而降低用户账户和对话数据的机密性和/或完整性<br/>[**T-0008**](#T-0008): 内部参与者可以否认向 AI 角色发出不当请求，这导致系统滥用缺乏问责制，从而降低审计日志和合规记录的问责性<br/>[**T-0009**](#T-0009): 具有系统访问权限的恶意用户可以操纵对话历史或角色响应，这导致数据篡改和对话完整性丢失，从而降低对话历史和角色响应的完整性 |  | 已解决 |  |
| <a name="M-0002"></a>M-0002 | 使用参数化提示和提示隔离来防止 AI 提示注入 | [**T-0001**](#T-0001): 具有系统认证访问权限的恶意用户可以向 AI 角色对话注入恶意提示，这导致 AI 响应操纵和潜在的系统入侵，从而降低 AI 角色响应和对话数据的机密性和/或完整性 |  | 已解决 |  |
| <a name="M-0001"></a>M-0001 | 对所有用户输入实施全面的输入验证和清理 | [**T-0001**](#T-0001): 具有系统认证访问权限的恶意用户可以向 AI 角色对话注入恶意提示，这导致 AI 响应操纵和潜在的系统入侵，从而降低 AI 角色响应和对话数据的机密性和/或完整性 |  | 已解决 |  |

## 受影响的资产

| 资产编号 | 资产 | 相关威胁 |
| --- | --- | --- |
| AS-0001 | 对话历史 | [**T-0009**](#T-0009): 具有系统访问权限的恶意用户可以操纵对话历史或角色响应，这导致数据篡改和对话完整性丢失，从而降低对话历史和角色响应的完整性 |
| AS-0002 | 角色响应 | [**T-0009**](#T-0009): 具有系统访问权限的恶意用户可以操纵对话历史或角色响应，这导致数据篡改和对话完整性丢失，从而降低对话历史和角色响应的完整性 |
| AS-0003 | 审计日志 | [**T-0008**](#T-0008): 内部参与者可以否认向 AI 角色发出不当请求，这导致系统滥用缺乏问责制，从而降低审计日志和合规记录的问责性 |
| AS-0004 | 合规记录 | [**T-0008**](#T-0008): 内部参与者可以否认向 AI 角色发出不当请求，这导致系统滥用缺乏问责制，从而降低审计日志和合规记录的问责性 |
| AS-0005 | 语音服务 | [**T-0007**](#T-0007): 恶意用户可以通过过量请求滥用语音合成服务，这导致资源耗尽和成本增加，从而降低语音服务的可用性 |
| AS-0006 | 用户账户 | [**T-0006**](#T-0006): 拥有被盗或被入侵 JWT 令牌的外部威胁参与者可以冒充合法用户，这导致对用户账户和数据的未授权访问，从而降低用户账户和对话数据的机密性和/或完整性 |
| AS-0007 | 对话数据 | [**T-0006**](#T-0006): 拥有被盗或被入侵 JWT 令牌的外部威胁参与者可以冒充合法用户，这导致对用户账户和数据的未授权访问，从而降低用户账户和对话数据的机密性和/或完整性<br/>[**T-0001**](#T-0001): 具有系统认证访问权限的恶意用户可以向 AI 角色对话注入恶意提示，这导致 AI 响应操纵和潜在的系统入侵，从而降低 AI 角色响应和对话数据的机密性和/或完整性 |
| AS-0008 | 图像处理服务 | [**T-0005**](#T-0005): 恶意用户可以上传包含可执行代码或恶意软件的恶意图像，这导致潜在的代码执行或系统入侵，从而降低图像处理服务和后端基础设施的完整性和/或可用性 |
| AS-0009 | 后端基础设施 | [**T-0005**](#T-0005): 恶意用户可以上传包含可执行代码或恶意软件的恶意图像，这导致潜在的代码执行或系统入侵，从而降低图像处理服务和后端基础设施的完整性和/或可用性 |
| AS-0010 | WebSocket 服务 | [**T-0004**](#T-0004): 外部威胁参与者可以用 WebSocket 连接请求淹没系统，这导致服务降级和拒绝服务，从而降低 WebSocket 服务和后端 API 服务的可用性 |
| AS-0011 | 后端 API 服务 | [**T-0004**](#T-0004): 外部威胁参与者可以用 WebSocket 连接请求淹没系统，这导致服务降级和拒绝服务，从而降低 WebSocket 服务和后端 API 服务的可用性 |
| AS-0012 | 用户对话 | [**T-0003**](#T-0003): 具有有效会话凭据的恶意用户可以访问其他用户的对话会话，这导致未授权的数据泄露和隐私侵犯，从而降低用户对话和会话数据的机密性 |
| AS-0013 | 会话数据 | [**T-0003**](#T-0003): 具有有效会话凭据的恶意用户可以访问其他用户的对话会话，这导致未授权的数据泄露和隐私侵犯，从而降低用户对话和会话数据的机密性 |
| AS-0014 | 后端服务 | [**T-0002**](#T-0002): 外部攻击者可以绕过 CloudFront 直接访问 ALB，这导致未授权的 API 访问和潜在的系统入侵，从而降低后端服务和用户数据的机密性、完整性和/或可用性 |
| AS-0015 | 用户数据 | [**T-0002**](#T-0002): 外部攻击者可以绕过 CloudFront 直接访问 ALB，这导致未授权的 API 访问和潜在的系统入侵，从而降低后端服务和用户数据的机密性、完整性和/或可用性 |
| AS-0016 | AI 角色响应 | [**T-0001**](#T-0001): 具有系统认证访问权限的恶意用户可以向 AI 角色对话注入恶意提示，这导致 AI 响应操纵和潜在的系统入侵，从而降低 AI 角色响应和对话数据的机密性和/或完整性 |