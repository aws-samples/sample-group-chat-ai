# Group Chat AI - ארכיטקטורת המערכת

> • 🇺🇸 **This document is also available in:** [English](../ARCHITECTURE.md)
> • 🇸🇦 **هذا المستند متوفر أيضاً بـ:** [العربية](./ARCHITECTURE_ar.md)
> • 🇩🇪 **Dieses Dokument ist auch verfügbar in:** [Deutsch](./ARCHITECTURE_de.md)
> • 🇪🇸 **Este documento también está disponible en:** [Español](./ARCHITECTURE_es.md)
> • 🇫🇷 **Ce document est également disponible en:** [Français](./ARCHITECTURE_fr.md)
> • 🇮🇱 **מסמך זה זמין גם ב:** [עברית](#)
> • 🇮🇹 **Questo documento è disponibile anche in:** [Italiano](./ARCHITECTURE_it.md)
> • 🇯🇵 **この文書は以下の言語でもご利用いただけます:** [日本語](./ARCHITECTURE_ja.md)
> • 🇰🇷 **이 문서는 다음 언어로도 제공됩니다:** [한국어](./ARCHITECTURE_ko.md)
> • 🇳🇱 **Dit document is ook beschikbaar in:** [Nederlands](./ARCHITECTURE_nl.md)
> • 🇵🇹 **Este documento também está disponível em:** [Português](./ARCHITECTURE_pt.md)
> • 🇷🇺 **Этот документ также доступен на:** [Русский](./ARCHITECTURE_ru.md)
> • 🇸🇪 **Detta dokument är också tillgängligt på:** [Svenska](./ARCHITECTURE_sv.md)
> • 🇨🇳 **本文档还提供以下语言版本:** [中文](./ARCHITECTURE_zh.md)


## סקירה כללית

Group Chat AI היא פלטפורמת AI שיחה מתקדמת בזמן אמת המאפשרת למשתמשים לקיים דיונים שיתופיים עם מספר פרסונות AI. המערכת מנצלת שירותי ענן של AWS כדי לספק פתרון מדרגי, מאובטח ובעל ביצועים גבוהים עם אינטראקציות קול וטקסט בזמן אמת לשיחות קבוצתיות.

## דיאגרמות ארכיטקטורה

### ארכיטקטורת מערכת ברמה גבוהה
![Group Chat AI System Architecture](ARCHITECTURE.png)

## רכיבי המערכת

### 1. שכבת הקצה הקדמי

#### **CloudFront Distribution**
- **מטרה**: רשת הפצת תוכן גלובלית לביצועים אופטימליים
- **תכונות**:
  - שמירה במטמון של נכסים סטטיים (build של אפליקציית React)
  - ניתוב בקשות API ל-ALB של הקצה האחורי
  - פרוקסי חיבורי WebSocket לתקשורת בזמן אמת
  - הגבלות גיאוגרפיות ומדיניות אבטחה
  - תמיכה בדומיין מותאם אישית עם תעודות ACM

#### **S3 Static Hosting**
- **מטרה**: מגיש את artifacts של build של אפליקציית React
- **תוכן**:
  - חבילות HTML, CSS, JavaScript
  - נכסים סטטיים (תמונות, גופנים, קבצי לוקליזציה)
  - קבצי קונפיגורציה דינמיים (config.json להגדרות ספציפיות לסביבה)

#### **React Frontend Application**
- **טכנולוגיה**: React 18 עם TypeScript, מערכת build של Vite
- **תכונות**:
  - תקשורת WebSocket בזמן אמת
  - יכולות קלט/פלט קול
  - בינאום רב-לשוני
  - עיצוב רספונסיבי עם רכיבי UI מודרניים
  - העלאה ועיבוד תמונות

### 2. אימות והרשאה

#### **Amazon Cognito User Pool**
- **מטרה**: אימות וניהול משתמשים מרכזי
- **תכונות**:
  - אינטגרציה OAuth 2.0 / OpenID Connect
  - רישום ואימות מבוסס אימייל
  - מדיניות סיסמאות ושחזור חשבון
  - אינטגרציה עם הקצה הקדמי דרך זרימת OIDC

#### **User Pool Client**
- **קונפיגורציה**:
  - זרימת Authorization Code Grant
  - כתובות URL של callback לסביבות פיתוח וייצור
  - היקפים: openid, email, profile
  - תקופות תוקף טוקן מותאמות לאבטחה

### 3. תשתית רשת

#### **VPC (Virtual Private Cloud)**
- **עיצוב**: פריסה רב-AZ לזמינות גבוהה
- **רשתות משנה**:
  - **רשתות משנה ציבוריות**: מארחות ALB ו-NAT Gateway
  - **רשתות משנה פרטיות**: מארחות משימות ECS Fargate לאבטחה

#### **Application Load Balancer (ALB)**
- **מטרה**: הפצת תעבורת HTTP/HTTPS וסיום SSL
- **אבטחה**: **קריטי - ALB מקבל תעבורה רק מטווחי IP של CloudFront**
- **תכונות**:
  - בדיקות בריאות לשירותי ECS
  - ניתוב מבוסס נתיב (/api/* → backend, /ws/* → WebSocket)
  - קבוצות אבטחה מוגדרות עם רשימות prefix מנוהלות של CloudFront
  - רישום גישה ל-S3
  - **כל תעבורת המשתמשים (HTTP/WebSocket) חייבת לעבור דרך CloudFront**

### 4. שירותי קצה אחורי (ECS Fargate)

#### **Express.js Application Server**
- **זמן ריצה**: Node.js 20 עם TypeScript
- **ארכיטקטורה**: עיצוב מוכוון מיקרו-שירותים
- **רכיבים מרכזיים**:
  - נקודות קצה REST API לניהול סשן
  - שרת WebSocket לתקשורת בזמן אמת
  - Middleware לרישום, טיפול בשגיאות ואבטחה

#### **רכיבי שירות מרכזיים**

##### **ConversationOrchestrator**
- **מטרה**: מתאם מרכזי לשיחות AI
- **אחריויות**:
  - ניתוב הודעות ובחירת פרסונה
  - ניהול תור אודיו לזרימת שיחה טבעית
  - הזרמת תגובות בזמן אמת
  - ניהול שיחות איטרטיבי

##### **PersonaManager & PersonaAgent**
- **מטרה**: מנהל הגדרות והתנהגויות פרסונות AI
- **תכונות**:
  - יצירה וניהול פרסונות מותאמות אישית
  - הקשרי שיחה ספציפיים לפרסונה
  - בחירת פרסונה דינמית מבוססת ניתוח תוכן

##### **RoutingAgent**
- **מטרה**: ניתוב חכם של הודעות משתמש לפרסונות מתאימות
- **טכנולוגיה**: משתמש ב-Amazon Bedrock לקבלת החלטות
- **תכונות**:
  - ניתוח תוכן וניקוד רלוונטיות פרסונה
  - לוגיקת המשך שיחה
  - תזמור אינטראקציה רב-פרסונה

##### **SessionService**
- **מטרה**: מנהל סשנים של משתמשים ומצב שיחה
- **תכונות**:
  - ניהול מחזור חיי סשן
  - שמירת היסטוריית שיחה
  - התאמות אישיות ספציפיות למשתמש

##### **WebSocket Management**
- **רכיבים**: WebSocketServer, WebSocketController, SessionWebSocketManager
- **תכונות**:
  - תקשורת דו-כיוונית בזמן אמת
  - חיבורי WebSocket ספציפיים לסשן
  - פרוטוקולי הזרמת אודיו ואישור

### 5. אינטגרציה שירותי AI/ML

#### **Amazon Bedrock**
- **מודלים**: Claude 4 (us.anthropic.claude-sonnet-4-20250514-v1:0)
- **שימוש**:
  - יצירת שיחות לפרסונות AI
  - ניתוח תוכן והחלטות ניתוב
  - יצירת תגובות מודעות הקשר
- **קונפיגורציה**: דרך Parameter Store להגדרות ספציפיות לסביבה

#### **Amazon Polly**
- **מטרה**: המרת טקסט לדיבור לאינטראקציות קול
- **תכונות**:
  - אפשרויות קול מרובות עם הקצאות ספציפיות לפרסונה
  - סגנון דיבור של כתב חדשות לפרסונות מסוימות
  - סינתזת אודיו בהזרמה
  - בחירת קול מודעת שפה

### 6. קונפיגורציה וניטור

#### **AWS Systems Manager Parameter Store**
- **מטרה**: ניהול קונפיגורציה מרכזי
- **פרמטרים**:
  - הגדרות מודל LLM וספק
  - פרטי קונפיגורציה Cognito
  - הגדרות ספציפיות לסביבה

#### **CloudWatch Logs & Metrics**
- **תכונות**:
  - רישום מרכזי לכל השירותים
  - מדדי ביצועים וניטור
  - מעקב שגיאות והתרעות
  - מדדים מותאמים אישית לשימוש בשירותי AI

## דפוסי זרימת נתונים

### 1. זרימת אימות משתמש
```
User → CloudFront → Cognito User Pool → OAuth Flow → JWT Token → API Calls
```

### 2. זרימת שיחה בזמן אמת
```
User Message → WebSocket (via CloudFront) → ALB → ConversationOrchestrator → RoutingAgent → PersonaAgent → Bedrock → Response → Polly → Audio Stream → WebSocket (via CloudFront) → User
```

### 3. צינור עיבוד AI
```
User Input → Content Analysis → Persona Selection → Context Building → LLM Request → Response Generation → Audio Synthesis → Queue Management → Delivery
```

## ארכיטקטורת אבטחה

### אבטחת רשת
- **אינטגרציה WAF**: Web Application Firewall משולב CloudFront
- **אבטחת VPC**: רשתות משנה פרטיות לשירותי קצה אחורי
- **קבוצות אבטחה**: בקרת גישה בהרשאה מינימלית
- **הגבלות ALB**: מגבלות טווח IP של CloudFront

### אבטחת נתונים
- **הצפנה במעבר**: HTTPS/TLS בכל מקום
- **הצפנה במנוחה**: הצפנת S3 ו-Parameter Store
- **ניהול סודות**: Parameter Store לקונפיגורציה רגישה
- **בקרת גישה**: תפקידי IAM עם הרשאות מינימליות

### אבטחת אפליקציה
- **אימות**: OAuth 2.0/OIDC מבוסס Cognito
- **הרשאה**: אימות טוקן JWT
- **אימות קלט**: אימות בקשות מקיף
- **הגבלת קצב**: מגבלות חיבור API ו-WebSocket

## מדרגיות וביצועים

### Auto Scaling
- **שירות ECS**: auto scaling מבוסס CPU וזיכרון (1-10 משימות)
- **ALB**: קנה מידה אוטומטי מבוסס תעבורה
- **CloudFront**: מיקומי edge גלובליים ל-CDN

### אופטימיזציות ביצועים
- **שמירה במטמון**: שמירה במטמון CloudFront לנכסים סטטיים
- **הזרמת אודיו**: כתובות URL של נתוני Base64 להשמעה מיידית
- **Connection Pooling**: ניהול יעיל של חיבורי WebSocket
- **Lazy Loading**: אתחול שירות לפי דרישה

### זמינות גבוהה
- **פריסה רב-AZ**: VPC משתרע על מספר אזורי זמינות
- **בדיקות בריאות**: ניטור בריאות ALB לשירותי ECS
- **הידרדרות חלקה**: מנגנוני fallback לכשלי שירות

## סיכום מחסנית טכנולוגיה

### קצה קדמי
- **Framework**: React 18 עם TypeScript
- **כלי Build**: Vite
- **עיצוב**: CSS מודרני עם עיצוב רספונסיבי
- **ניהול מצב**: React Context API
- **אימות**: OIDC Client
- **זמן אמת**: WebSocket API

### קצה אחורי
- **זמן ריצה**: Node.js 20
- **Framework**: Express.js
- **שפה**: TypeScript
- **WebSocket**: ספריית ws
- **רישום**: Winston
- **בדיקות**: Jest

### תשתית
- **תזמור**: AWS CDK (TypeScript)
- **חישוב**: ECS Fargate
- **אחסון**: S3
- **CDN**: CloudFront
- **מסד נתונים**: ניהול מצב בזיכרון
- **קונפיגורציה**: Parameter Store

### AI/ML
- **LLM**: Amazon Bedrock (Claude 4)
- **TTS**: Amazon Polly
- **ניתוח תוכן**: שירות מותאם אישית עם אינטגרציה LLM

## ארכיטקטורת פריסה

### אסטרטגיית סביבה
- **פיתוח**: פיתוח מקומי עם פורט קצה אחורי 3000
- **ייצור**: תשתית פרוסה CDK עם CloudFront

### צינור CI/CD
- **קצה קדמי**: Vite build → פריסת S3 → ביטול CloudFront
- **קצה אחורי**: Docker build → ECR → עדכון שירות ECS
- **תשתית**: CDK diff → Deploy → אימות

### ניהול קונפיגורציה
- **משתני סביבה**: קונפיגורציה ברמת מכולה
- **סודות**: אינטגרציה Parameter Store
- **דגלי תכונה**: הפעלה מבוססת סביבה

## ניטור ו-Observability

### אסטרטגיית רישום
- **מרכזי**: כל הלוגים זורמים ל-CloudWatch
- **מובנה**: רשומות לוג בפורמט JSON
- **מתאם**: מזהי בקשה למעקב
- **רמות**: סיווג Debug, Info, Warn, Error

### מדדים והתרעות
- **מדדי אפליקציה**: זמני תגובה, שיעורי שגיאה
- **מדדי תשתית**: ניצול CPU, זיכרון, רשת
- **מדדים עסקיים**: שיעורי השלמת שיחה, שימוש בפרסונה
- **התרעות מותאמות**: זיהוי בעיות פרואקטיבי

### ניטור בריאות
- **נקודות קצה בריאות**: /health למצב שירות
- **בדיקות תלות**: קישוריות שירות חיצוני
- **הידרדרות חלקה**: ניטור התנהגות fallback

## שיקולי ארכיטקטורה עתידיים

### שיפורי מדרגיות
- **אינטגרציה מסד נתונים**: שקול RDS לאחסון קבוע
- **שכבת שמירה במטמון**: Redis/ElastiCache למצב סשן
- **מיקרו-שירותים**: פירוק שירות נוסף

### שיפורי AI/ML
- **כוונון מודל**: אימון מודל מותאם אישית
- **בדיקות A/B**: השוואת מודלים מרובים
- **אנליטיקת שיחה**: תובנות שימוש מתקדמות

### שיפורי אבטחה
- **כללי WAF**: הגנה משופרת מפני התקפות
- **API Gateway**: שקול מיגרציה לתכונות מתקדמות
- **תאימות**: שיקולי SOC 2, GDPR

ארכיטקטורה זו מספקת בסיס חזק, מדרגי ומאובטח לפלטפורמת Group Chat AI תוך שמירה על גמישות לשיפורים עתידיים וצמיחה.